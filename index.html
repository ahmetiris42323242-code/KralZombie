<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Kral’ın Zombi Avcısı – Gelişmiş 🧟‍♂️</title>
<style>
  body { margin:0; overflow:hidden; background:black; font-family:sans-serif; }
  canvas { display:block; margin:0 auto; background:radial-gradient(circle at center,#050505 0%,#000 100%); }
  #startBtn { position:absolute; top:15%; left:50%; transform:translateX(-50%); font-size:28px; background:crimson; color:white; border:none; padding:20px 40px; border-radius:15px; cursor:pointer; }
  #startBtn:hover { background:darkred; }
  #devPanel { position:absolute; bottom:80px; right:20px; background:#222; color:white; padding:10px; border-radius:10px; text-align:center; font-size:14px; display:none; }
  #devPanel input, #devPanel button { font-size:14px; margin:3px; padding:5px; border-radius:5px; }
  #togglePanelBtn { position:absolute; bottom:20px; right:20px; padding:10px; border-radius:8px; background:#444; color:white; border:none; font-size:16px; cursor:pointer; }
  #resumeBtn, #restartBtn { display:none; position:absolute; left:50%; transform:translateX(-50%); font-size:24px; padding:15px 30px; border-radius:10px; border:none; cursor:pointer; background:crimson; color:white; }
  #resumeBtn:hover, #restartBtn:hover { background:darkred; }
  #resumeBtn { top:40%; }
  #restartBtn { top:50%; }
  #buffs { position:absolute; top:90px; left:20px; color:white; font-size:16px; }
</style>
</head>
<body>

<button id="startBtn">🎮 Oyunu Başlat</button>

<div id="devPanel">
  <p>Yapımcı Girişi</p>
  <input type="password" id="devPass" placeholder="4 haneli şifre">
  <button id="unlockBtn">Giriş</button><br>
  <button id="spawnBossBtn" disabled>Boss’u Çağır</button>
  <button id="godModeBtn" disabled>Ölümsüzlük</button>
</div>

<button id="togglePanelBtn">Paneli Göster/Gizle</button>
<button id="resumeBtn">Devam Et ▶️</button>
<button id="restartBtn">Yeniden Başlat 🔁</button>
<div id="buffs"></div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

function resizeCanvas(){ canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

const startBtn = document.getElementById("startBtn");
const devPanel = document.getElementById("devPanel");
const devPass = document.getElementById("devPass");
const unlockBtn = document.getElementById("unlockBtn");
const spawnBossBtn = document.getElementById("spawnBossBtn");
const godModeBtn = document.getElementById("godModeBtn");
const togglePanelBtn = document.getElementById("togglePanelBtn");
const resumeBtn = document.getElementById("resumeBtn");
const restartBtn = document.getElementById("restartBtn");
const buffsDiv = document.getElementById("buffs");

const DEV_CODE = "7536";

let gameStarted=false, paused=false;
let zombies=[], bullets=[], bloods=[];
let score=0, highScore=localStorage.getItem("highScore")||0;
let playerX = canvas.width/2;
let bossActive=false, boss=null, bossForced=false, bossSpawnedOnce=false;
let bulletSpeed=8, godMode=false;
let buffs={speed: false, power: false, invincible: false};
let isPC = !("ontouchstart" in window);
let touchX = null;

// Mobil dokunmatik
canvas.addEventListener("touchstart",(e)=>{ touchX = e.touches[0].clientX; bullets.push({x:touchX,y:canvas.height-60,speed:bulletSpeed}); });
canvas.addEventListener("touchmove",(e)=>{ touchX = e.touches[0].clientX; });
canvas.addEventListener("touchend",(e)=>{ touchX = null; });

// PC fare
if(isPC){
  canvas.addEventListener("mousemove", (e) => { playerX = e.clientX; });
  canvas.addEventListener("click", (e) => { bullets.push({x:playerX,y:canvas.height-60,speed:bulletSpeed}); });
}

// ESC tuşu pause
document.addEventListener("keydown",(e)=>{
  if(e.key==="Escape" && gameStarted){ paused=!paused; resumeBtn.style.display=paused?"block":"none"; restartBtn.style.display=paused?"block":"none"; }
});

class Zombie{
  constructor(x,y,speed,isBoss=false, mini=false){
    this.x=x; this.y=y; this.width=isBoss?150:50; this.height=isBoss?200:80;
    this.speed=speed; this.alpha=0; this.hit=false;
    this.health=isBoss?20: mini?5:1; this.maxHealth=this.health;
    this.isBoss=isBoss; this.mini=mini; this.direction=Math.random()<0.5?-1:1; this.walkOffset=0;
  }
  update(){ this.y+=this.speed; if(!this.isBoss) this.x+=Math.sin(this.walkOffset)*this.direction; this.walkOffset+=0.1; }
  draw(){
    if(this.alpha<1)this.alpha+=0.02;
    ctx.globalAlpha=this.alpha;
    ctx.fillStyle=this.hit?"darkred":(this.isBoss?"purple":(this.mini?"orange":"green"));
    ctx.fillRect(this.x,this.y,this.width,this.height);
    ctx.globalAlpha=1;
    if(this.isBoss || this.mini){
      const barWidth=300, barHeight=25, barX=canvas.width/2-barWidth/2, barY=20;
      const healthPercent=this.health/this.maxHealth;
      ctx.fillStyle="gray"; ctx.fillRect(barX,barY,barWidth,barHeight);
      ctx.fillStyle="red"; ctx.fillRect(barX,barY,barWidth*healthPercent,barHeight);
      ctx.strokeStyle="white"; ctx.strokeRect(barX,barY,barWidth,barHeight);
    }
  }
}

function drawFog(){
  const grad=ctx.createLinearGradient(0,0,0,canvas.height);
  grad.addColorStop(0,"rgba(255,255,255,0.03)");
  grad.addColorStop(0.5,"rgba(0,0,0,0.4)");
  grad.addColorStop(1,"rgba(0,0,0,0.9)");
  ctx.fillStyle=grad; ctx.fillRect(0,0,canvas.width,canvas.height);
}

startBtn.addEventListener("click",()=>{
  startBtn.style.display="none"; devPanel.style.display="block";
  gameStarted=true; paused=false; score=0; bossSpawnedOnce=false;
  zombies=[]; bullets=[]; bloods=[]; bossActive=false; boss=null; buffs={speed:false,power:false,invincible:false};
  loop();
});

unlockBtn.addEventListener("click",()=>{
  if(devPass.value===DEV_CODE){
    spawnBossBtn.disabled=false; godModeBtn.disabled=false;
    alert("Yapımcı girişi başarılı!");
  } else { alert("Şifre yanlış!"); }
});
devPass.addEventListener("keydown", (e) => { if(e.key==="Enter") unlockBtn.click(); });

spawnBossBtn.addEventListener("click",()=>{ if(!bossActive){ spawnBoss(); bossForced=true; } });
godModeBtn.addEventListener("click",()=>{ buffs.invincible=!buffs.invincible; alert("Ölümsüzlük "+(buffs.invincible?"aktif!":"kapalı!")); updateBuffDisplay(); });
togglePanelBtn.addEventListener("click",()=>{ devPanel.style.display=(devPanel.style.display==="none"?"block":"none"); });
resumeBtn.addEventListener("click",()=>{ paused=false; resumeBtn.style.display="none"; restartBtn.style.display="none"; loop(); });
restartBtn.addEventListener("click",()=>{ paused=false; resumeBtn.style.display="none"; restartBtn.style.display="none"; startBtn.style.display="block"; startBtn.textContent="🎮 Oyunu Başlat"; gameStarted=false; bossActive=false; bossForced=false; bossSpawnedOnce=false; });

function spawnZombie(mini=false){ 
  if(!bossActive) zombies.push(new Zombie(Math.random()*(canvas.width-80),-100,1+Math.random()*1.2, false, mini)); 
}
function spawnBoss(mini=false){ bossActive=true; boss=new Zombie(canvas.width/2-75,-250,0.5,true,mini); zombies.push(boss); }

function applyBuff(type, duration){
  buffs[type]=true;
  updateBuffDisplay();
  setTimeout(()=>{ buffs[type]=false; updateBuffDisplay(); }, duration);
}
function updateBuffDisplay(){
  let text="Buffs: ";
  for(let key in buffs){ if(buffs[key]) text+=key+" "; }
  buffsDiv.textContent=text;
}

function loop(){
  if(!gameStarted || paused) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="black"; ctx.fillRect(0,0,canvas.width,canvas.height);
  drawFog();

  if(touchX!==null && !isPC) playerX=touchX;
  ctx.fillStyle="gray"; ctx.fillRect(playerX-10,canvas.height-50,20,50);

  let speedMultiplier=buffs.speed?2:1;
  bullets.forEach((b,i)=>{ b.y-=b.speed*(buffs.power?2:1); ctx.fillStyle="yellow"; ctx.fillRect(b.x-2,b.y,4,10); if(b.y<0) bullets.splice(i,1); });

  zombies.forEach((z,zi)=>{
    if(!z.hit){
      z.update(); z.draw();
      bullets.forEach((b,bi)=>{
        if(b.x>z.x && b.x<z.x+z.width && b.y<z.y+z.height && b.y>z.y){
          z.health-=buffs.power?2:1; bullets.splice(bi,1);
          score+=z.isBoss?5:10;
          if(z.health<=0){
            z.hit=true;
            if(z.isBoss){ bossActive=false; }
          }
        }
      });
      if(z.y+z.height>=canvas.height && !buffs.invincible) gameOver();
    }
  });

  const now=Date.now();
  ctx.fillStyle="white"; ctx.font="24px Arial"; 
  ctx.fillText("Skor: "+score,20,30); 
  ctx.fillText("En Yüksek Skor: "+highScore,20,60);

  // Her 500 puanda mini-boss / boss spawn
  if(score>=500 && !bossSpawnedOnce){ spawnZombie(true); bossSpawnedOnce=true; applyBuff('speed',10000); applyBuff('power',10000); }
  if(score>=1000 && !bossForced){ spawnBoss(); bossForced=true; applyBuff('invincible',10000); }

  if(!bossActive && Math.random()<0.02) spawnZombie();

  requestAnimationFrame(loop);
}

function gameOver(){
  gameStarted=false;
  if(score>highScore){ highScore=score; localStorage.setItem("highScore",score); }
  ctx.fillStyle="red"; ctx.font="48px Arial";
  ctx.fillText("💀 Kaybettin Kral 💀",canvas.width/2-200,canvas.height/2);
  setTimeout(()=>{
    startBtn.style.display="block"; spawnBossBtn.disabled=true; godMode=false; godModeBtn.disabled=true;
    bossForced=false; bossSpawnedOnce=false; startBtn.textContent="Tekrar Dene 🔁";
  },1500);
}
</script>
</body>
</html>
